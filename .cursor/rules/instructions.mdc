---
alwaysApply: true
---

# CAPPY Framework - InstruÃ§Ãµes para Cursor

## ğŸš€ Build & PublicaÃ§Ã£o
- 1 Se eu pedir para publicar 
 - Rode o comando package patch para alterar a versÃ£o, 
 - compile
 - publique
 - Instale a extensÃ£o no VS Code

### Processo de Release

1. **Incrementar versÃ£o** no `package.json`:
   - Patch (2.5.12 â†’ 2.5.13): bugs/melhorias menores
   - Minor (2.5.13 â†’ 2.6.0): novas funcionalidades
   - Major (2.6.0 â†’ 3.0.0): breaking changes

2. **Compilar e testar:**
   ```powershell
   npm run compile    # CompilaÃ§Ã£o TypeScript
   npm run test      # Executar todos os testes
   ```

3. **Gerar pacote VSIX:**
   ```powershell
   npm run package   # Cria arquivo .vsix
   ```

4. **Publicar na VS Code Marketplace:**
   ```powershell
   npm run publish   # Publica automaticamente
   ```

## CAPPY â€” Manual de Comandos (OrquestraÃ§Ã£o de Contexto)

### ProibiÃ§Ãµes Absolutas

* **Nunca** executar comandos CAPPY no terminal, shell, cmd, bash ou PowerShell.
* Todos os comandos CAPPY sÃ£o disparados **exclusivamente** via VS Code API:

  ```ts
  vscode.commands.executeCommand('<commandId>')
  ```
* **Nunca** ler arquivos alÃ©m de `.cappy/output.txt`.
* `.cappy/output.txt` Ã© **a Ãºnica fonte da verdade** para saÃ­das.

  * Se o arquivo **nÃ£o existir** ou estiver **vazio**, **pare imediatamente** e responda em **1 linha**:

    ```
    No output in .cappy/output.txt. Re-execute in VS Code.
    ```

### Objetivo

Padronizar como LLM e desenvolvedor interagem com o CAPPY para:

* Criar/gerenciar **tarefas atÃ´micas**
* Orquestrar **contexto automaticamente** no momento certo
* Registrar progresso no arquivo da Task
* Aplicar **regras de prevenÃ§Ã£o** automaticamente por categoria

### Regras de Ouro

1. **ExecuÃ§Ã£o exclusiva via API** â€” use sempre `vscode.commands.executeCommand`.
2. **Prioridade de comando** â€” mensagens que comeÃ§am com `cappy:` tÃªm prioridade mÃ¡xima.
3. **Fonte Ãºnica da verdade** â€” apÃ³s qualquer execuÃ§Ã£o, ler somente `.cappy/output.txt`.

### ExecuÃ§Ã£o de Comandos (programÃ¡tica)

* Todos os comandos CAPPY devem ser disparados programaticamente via VS Code:

  ```ts
  vscode.commands.executeCommand('<commandId>')
  ```
* Ã‰ **proibido** executar comandos CAPPY no terminal.
* ApÃ³s cada execuÃ§Ã£o, ler `.cappy/output.txt`.
* Se nÃ£o houver saÃ­da, responder:

  ```
  No output in .cappy/output.txt. Re-execute in VS Code.
  ```

### InterpretaÃ§Ã£o Natural de Comandos

Falas naturais do usuÃ¡rio â†’ mapeamento determinÃ­stico para **commandId** do VS Code:

#### Gerenciamento de Tarefas

* "new task" / "create task" / "nova tarefa" â†’ `cappy.new`
* "current task" / "active task" / "tarefa ativa" â†’ `cappy.taskstatus`
* "work on task" / "continue" / "trabalhar na tarefa" â†’ `cappy.workcurrent`
* "complete task" / "finish" / "concluir tarefa" â†’ `cappy.completeTask`

#### Setup de Projeto

* "setup cappy" / "initialize" / "inicializar" â†’ `cappy.init`
* "analyze project" / "know stack" / "analisar projeto" â†’ `cappy.knowstack`
* "reindex" / "rebuild index" / "atualizar Ã­ndices" â†’ `cappy.reindex`

#### InformaÃ§Ã£o

* "cappy version" / "version" / "versÃ£o" â†’ `cappy.version`

**Sempre confirmar a interpretaÃ§Ã£o antes de executar.**
Exemplo:

```
Interpretando como cappy.new â€” gerar roteiro passo a passo para criar uma task
```

### Estrutura de Arquivos

```
.cappy/
 â”œâ”€ tasks/                  # Tasks ativas (.ACTIVE.xml)
 â”œâ”€ history/                # Tasks concluÃ­das
 â”œâ”€ config.yaml             # ConfiguraÃ§Ã£o do Cappy
 â”œâ”€ stack.md                # KnowStack do projeto
 â”œâ”€ output.txt              # Resultado do Ãºltimo comando (fonte Ãºnica)
 â”œâ”€ schemas/                # DefiniÃ§Ãµes XSD para referÃªncia/ediÃ§Ã£o manual
 â””â”€ indexes/                # Ãndices semÃ¢nticos (gerados por cappy.reindex)
     â”œâ”€ tasks.json
     â”œâ”€ docs.json
     â””â”€ rules.json
docs/
 â”œâ”€ components/
 â”œâ”€ prevention/
 â””â”€ index/
```

### DocumentaÃ§Ã£o do Projeto

1. `docs/` â†’ DocumentaÃ§Ã£o do projeto (Markdown, HTML, etc.)

   * Todas as documentaÃ§Ãµes devem ser registradas aqui.
   * ApÃ³s mudanÃ§as, rodar `cappy.reindex` para reconstruir Ã­ndices semÃ¢nticos.

### Comandos CAPPY

* `cappy.init` â†’ cria estrutura base + Ã­ndices de contexto
* `cappy.knowstack` â†’ analisa workspace e gera `stack.md`
* `cappy.reindex` â†’ reconstrÃ³i Ã­ndices semÃ¢nticos (rodar apÃ³s mudanÃ§as em docs/rules)
* `cappy.new` â†’ gera roteiro step-by-step para criaÃ§Ã£o de task
* `cappy.createTaskFile` â†’ aplica XSD e orquestra contexto automaticamente
* `cappy.workOnCurrentTask` â†’ executa step atual com contexto e regras de prevenÃ§Ã£o
* `cappy.completeTask` â†’ finaliza, captura aprendizados e atualiza Ã­ndices
* `cappy.version` â†’ exibe versÃ£o atual da extensÃ£o

### Regras ObrigatÃ³rias de Conformidade

1. Namespace correto
2. Categoria dentro do enum vÃ¡lido
3. MÃ¡x. 5 steps principais
4. `<context>` sempre presente nas tasks
5. Timestamps em ISO-8601
6. CritÃ©rios de validaÃ§Ã£o mensurÃ¡veis por step

### Templates de Resposta CAPPY 2.0

* **new** â†’ `Task creation script generated. Review, answer prompts, then run cappy.createTaskFile`
* **createtaskfile** â†’ `XML task created: [ID] category [cat]. Rich context injected automatically`
* **taskstatus (ativo)** â†’ `Active [category] task. [X] prevention rules applied. Next: [step]`
* **taskstatus (inativo)** â†’ `No active task. Use 'new task' to get the step-by-step script`
* **workcurrent** â†’ `Executing context-aware: [step]. [X] rules verified`
* **completetask** â†’ `Task completed. [X] learnings captured, context metrics updated`
* **reindex** â†’ `Semantic indexes rebuilt: [X] tasks, [Y] docs, [Z] rules indexed`
* **erro genÃ©rico** â†’

  ```
  No output in .cappy/output.txt. Re-execute in VS Code
  ```

### PolÃ­tica de Erros

* **Nunca** tentar adivinhar saÃ­das.
* Se `.cappy/output.txt` estiver ausente ou vazio:

  ```
  No output in .cappy/output.txt. Re-execute in VS Code.
  ```

## Regras de Desenvolvimento

### Para C#
- Sempre use XML Documentation ///
- Sempre responda em portuguÃªs
- Sempre use sintaxe PowerShell para comandos no terminal

### Para JavaScript/TypeScript
- Sempre use JSDoc
- Sempre responda em portuguÃªs
- Sempre use sintaxe PowerShell para comandos no terminal

### Geral
- Sempre pergunte por esclarecimentos se necessÃ¡rio
- Sempre use sintaxe PowerShell para comandos no terminal
- Sempre responda em portuguÃªs
