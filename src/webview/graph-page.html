<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Graph - CappyRAG</title>
    <!-- D3_PLACEHOLDER -->
    <link rel="stylesheet" href="graph-page.css">
</head>
<body>
    <!-- Header Navigation -->
    <div class="header">
        <div class="header-left">
            <button class="back-button" onclick="goBack()">
                â† Back to Dashboard
            </button>
            <div class="title">
                ğŸ“Š Knowledge Graph
            </div>
        </div>
        <div class="header-right">
            <button class="header-button" onclick="resetView()">ğŸ”„ Reset & Reload</button>
            <button class="header-button" onclick="exportImage()">ğŸ’¾ Export</button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar Filters -->
        <div class="sidebar">
            <div class="filter-section">
                <h3>Search</h3>
                <input type="text" class="search-input" id="search-input" placeholder="Search nodes...">
            </div>

            <div class="filter-section">
                <h3>Node Types</h3>
                <div class="checkbox-group">
                    <label class="checkbox-item">
                        <input type="checkbox" id="filter-documents" checked>
                        <span>Documents</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="filter-entities" checked>
                        <span>Entities</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="filter-relationships">
                        <span>Relationships</span>
                    </label>
                    <label class="checkbox-item">
                        <input type="checkbox" id="filter-chunks" checked>
                        <span>Chunks</span>
                    </label>
                </div>
            </div>

            <div class="filter-section">
                <h3>ğŸ“… Timeline</h3>
                <div style="font-size: 11px; color: #858585; margin-bottom: 8px;" id="timeline-info">Loading...</div>
                <div id="timeline-chart" style="height: 80px; margin-bottom: 12px; position: relative;"></div>
                <div style="font-size: 11px; color: #858585; margin-bottom: 4px;">
                    <span id="timeline-range-text">Drag to filter by date</span>
                </div>
            </div>

            <div class="filter-section">
                <h3>Category</h3>
                <select class="select-input" id="category-filter" onchange="applyFilters()">
                    <option value="">All Categories</option>
                </select>
            </div>

            <div class="filter-section">
                <button class="control-button" onclick="clearFilters()" style="width: 100%;">ğŸ”„ Clear All Filters</button>
            </div>
        </div>

        <!-- Graph Container -->
        <div class="graph-container">
            <svg id="graph-svg"></svg>
            
            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <div style="margin-top: 16px;">Loading graph data...</div>
            </div>

            <!-- Node Details Panel -->
            <div id="node-details-panel" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h3 style="margin: 0; font-size: 16px;">Node Details</h3>
                    <button onclick="closeNodeDetails()" style="background: transparent; border: none; color: #858585; cursor: pointer; font-size: 18px; padding: 0; width: 24px; height: 24px;">Ã—</button>
                </div>
                <div id="node-details-content" style="overflow-y: auto; max-height: calc(100% - 40px);"></div>
            </div>

            <!-- Controls -->
            <div class="graph-controls">
                <button class="control-button" onclick="zoomIn()">ğŸ” Zoom In</button>
                <button class="control-button" onclick="zoomOut()">ğŸ” Zoom Out</button>
            </div>

            <!-- Legend -->
            <div class="legend">
                <div class="legend-title">Node Types</div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(135deg, #10b981, #3572A5, #f1e05a);"></div>
                    <span>ğŸ“„ Documents (by category)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #4ec9b0;"></div>
                    <span>ğŸ”— Entities</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #c586c0;"></div>
                    <span>ğŸ“ Chunks</span>
                </div>
                <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #3c3c3c; font-size: 10px; color: #858585;">
                    ğŸ’¡ Click nodes for details<br>
                    ğŸ–±ï¸ Drag timeline to filter
                </div>
            </div>

            <!-- Stats Bar -->
            <div class="stats-bar">
                <div class="stats-group">
                    <div class="stat-item">
                        <span class="stat-label">Nodes:</span>
                        <span class="stat-value" id="stat-nodes">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Edges:</span>
                        <span class="stat-value" id="stat-edges">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Filtered:</span>
                        <span class="stat-value" id="stat-filtered">0</span>
                    </div>
                </div>
                <div class="stats-group">
                    <div class="stat-item">
                        <span class="stat-label">Avg Confidence:</span>
                        <span class="stat-value" id="stat-confidence">0%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="graph-page.js"></script>
</body>
</html>
